[TOC]


# Linux

Linux是一个多用户分时系统。一切皆文件。

## Linux版本分类：

1. **内核版本：** Linux不是一个操作系统，严格来讲，Linux只是一个操作系统中的内核。内核是什么？内核建立了计算机软件与硬件之间通讯的平台，内核提供系统服务，比如文件管理、虚拟内存、设备I/O等；
2. **发行版本：** 一些组织或公司在内核版基础上进行二次开发而重新发行的版本。Linux发行版本有很多种（ubuntu和CentOS用的都很多）

## Linux文件系统：

**在Linux操作系统中，所有被操作系统管理的资源，例如网络接口卡、磁盘驱动器、打印机、输入输出设备、普通文件或是目录都被看作是一个文件。**

**一切都是文件**。

**inode**是linux/unix文件系统和硬盘存储的基础。

文件存储在硬盘上，硬盘的最小存储单位是扇区(Sector),每个扇区存储512字节(0.5kb)。 操作系统读取硬盘的数据时，不会一个扇区一个扇区的读取，这样做效率较低，而是**一次读取多个扇区， 即一次读取一个块(block)**。块由多个扇区组成，是文件读取的最小单位，块的最常见的大小是4kb， 约为8个连续的扇区组成。文件数据存储在块中， 但还需要一个空间来存储文件的元信息metadata，如文件拥有者，创建时间，权限，大小等。 **这种存储文件元信息的区域就叫inode，译为索引节点**。 每个文件都有一个inode，存储文件的元信息。 使用 stat 命令可以查看文件的inode信息。每个inode都有一个号码， Linux/Unix操作系统不使用文件名来区分文件，而是使用inode号码区分不同的文件。

inode也需要消耗硬盘空间，所以在格式化硬盘的时候，操作系统会将硬盘分为2个区域， 一个区域存放文件数据，另一个区域存放inode所包含的信息， 存放inode的区域被称为inode table。

**Linux文件类型**，其中非常重要的文件类型有: 普通文件，目录文件，链接文件，设备文件，管道文件，Socket套接字文件等。

- 普通文件: 普通文件是指txt,html,pdf等等的这样应用层面的文件类型， 用户可以根据访问权限对普通文件进行访问，修改和删除。

- 目录文件: 目录也是一种文件，打开目录实际上是打开目录文件。 目录文件包含了它目录下的所有文件名以及指向这些文件的指针。

- 链接文件: 链接文件分为符号链接(软链接)文件和硬链接文件

  - 硬链接(Hard Link):硬链接的文件拥有相同的inode，因为操作系统是靠inode来区分文件的， 2个inode相同的文件，就代表它们是一个文件。 删除一个文件并不会对其他拥有相同inode的文件产生影响，只有当inode相同的所有文件被删除了， 这个文件才会被删除。换言之，你建立一个文件的硬链接，这个文件和硬链接它们的inode是相同的, 无论你删除的是硬链接还是源文件，都不会对彼此造成影响,除非你把硬链接和源文件都删除， 这个文件才被删除。
  - 符号链接(软链接)(Symbolic Link): 符号链接类似于Windows上的快捷方式，它保存了源文件的路径。 当符号链接被删除时，并不会影响源文件。但是当源文件被删除时，符号链接就找不到源文件了。

- 设备文件 设备文件分为块设备文件和字符设备文件,设备文件一般存于/dev目录下。

  - 字符设备文件: **字符设备是依照先后顺序被存取数据的设备，通常不支持随机存取， 此类设备可以按字节/字符来读取数据，** 如键盘，串口等等。
  - 块设备文件: **块设备是可以被随机存取数据的设备，应用程序可以访问块设备上任何一块位置。 块设备以块的方式读取数据，在windows下也称为簇，块设备不支持字符的方式寻址。** 如硬盘，软盘，光碟等等。

  **字符设备与块设备最根本的区别就是它们是否可以被随机访问。** 如键盘，当我们在键盘上敲下一个单词: "word"的时候， 那么系统肯定是需要按照顺序来进行读取word的字节流(字符流)的，随机访问在此时是没有意义的。

- 管道文件: 管道文件一般用于进程间通信，使用mkfifo命令可以创建一个管道文件。

- Socket套接字文件: 套接字文件被用于网络进程之间的通信，既可以使2台不同的机器进行通信，也可以用于本机的Socket网络程序。

**目录配置**

为了使不同 Linux 发行版本的目录结构保持一致性，Filesystem Hierarchy Standard (FHS) 规定了 Linux 的目录结构。最基础的三个目录如下：

- / (root, 根目录)

- /usr (unix software resource)：所有系统默认软件都会安装到这个目录；

- /var (variable)：存放系统或程序运行过程中的数据文件。

  

**Linux目录树**

- **/bin：** 存放二进制可执行文件(ls、cat、mkdir等)，常用命令一般都在这里；
- **/etc：** 存放系统管理和配置文件；
- **/home：** 存放所有用户文件的根目录，是用户主目录的基点，比如用户user的主目录就是/home/user，可以用~user表示；
- **/usr ：** 用于存放系统应用程序；
- **/opt：** 额外安装的可选应用程序包所放置的位置。一般情况下，我们可以把tomcat等都安装到这里；
- **/proc：** 虚拟文件系统目录，是系统内存的映射。可直接访问这个目录来获取系统信息；
- **/root：** 超级用户（系统管理员）的主目录（特权阶级^o^）；
- **/sbin:** 存放二进制可执行文件，只有root才能访问。这里存放的是系统管理员使用的系统级别的管理命令和程序。如ifconfig等；
- **/dev：** 用于存放设备文件；
- **/mnt：** 系统管理员安装临时文件系统的安装点，系统提供这个目录是让用户临时挂载其他的文件系统；
- **/boot：** 存放用于系统引导时使用的各种文件；
- **/lib ：** 存放着和系统运行相关的库文件 ；
- **/tmp：** 用于存放各种临时文件，是公用的临时文件存储点；
- **/var：** 用于存放运行时需要改变数据的文件，也是某些大文件的溢出区，比方说各种服务的日志文件（系统启动日志等。）等；
- **/lost+found：** 这个目录平时是空的，系统非正常关机而留下“无家可归”的文件（windows下叫什么.chk）就在这里。

# Linux命令

Linux命令大全：http://man.linuxde.net/

## 基本命令

### 快捷键

- Tab：命令和文件名补全；
- Ctrl+C：中断正在运行的程序；
- Ctrl+D：结束键盘输入（End Of File，EOF）

### 目录切换命令

- **`cd usr`：** 切换到该目录下usr目录
- **`cd ..`：** 切换到上一层目录
- **`cd /`：** 切换到系统根目录
- **`cd ~`：** 切换到用户主目录
- **`cd -`：** 切换到上一个操作所在目录

### 目录的操作命令(增删改查)

- **`mkdir 目录名称`：** 增加目录 （增）

- **`ls -a`** 查看当前目录下的所有目录和文件（包括隐藏的文件）（查）

- **`ls或者ll`**（ll是ls -l的别名）：列表查看目录信息（查）

- **`find 目录 参数`：** 查找目录，`find /home -name "*.txt"` （查）

- **`mv 目录名称 新目录名称`：** 重命名目录（改）

- **`mv 目录名称 目录的新位置`：** 剪切目录（改）

- **`cp 目录名称 目录拷贝的目标位置`：** 拷贝目录（改）

- **`rm -rf 目录`:** 删除目录（删）

  -r 递归。  -f 不询问

### 文件的操作命令(增删改查)

- **`touch 文件名称`:** 文件的创建（增）
- **`cat/more/less/tail 文件名称`** 文件的查看（查）
  - **`cat`：** 显示最后一屏内容， `tac` 反向操作，从最后一行开始打印。
  - **`more`：** 百分比显示，回车可以向下一行， 空格可以向下一页，q退出查看
  - **`less`：** 翻页查看，PgUp和PgDn向上和向下翻页，q结束查看
  - **`head`: **   取得文件前几行
  - **`tail -10` ：** 查看文件的后10行，Ctrl+C结束，
  -  **`tail -f` ：**文件 可以对某个文件进行动态监控

- **`vi或vim 文件`：** 修改文件的内容（改）
- **`rm -rf 文件`：** 删除文件（删）

### 文件的权限命令

在Linux中权限一般分为读(readable)、写(writable)和执行(excutable)，分为三组。分别对应文件的属主(owner)，属组(group)和其他用户(other)，通过这样的机制来限制哪些用户、哪些组可以对特定的文件进行什么样的操作。通过 **`ls -l`** 命令我们可以 查看某个目录下的文件或目录的权限

![](https://github.com/pixx1225/Axing-Tech/blob/master/images/Linux文件权限.jfif)

**文件的类型：**

- d： 代表目录
- -： 代表文件
- l： 代表软链接（可以认为是window中的快捷方式）

**Linux中权限分为以下几种：**

- r：代表权限是可读，r也可以用数字4表示
- w：代表权限是可写，w也可以用数字2表示
- x：代表权限是可执行，x也可以用数字1表示

**修改文件/目录的权限的命令：`chmod`**

`chmod 764 aaa.txt` == `chmod u=rwx,g=rw,o=r aaa.txt`

```html
# chmod [ugoa] [+-=] [rwx] dirname/filename
- u：拥有者
- g：所属群组
- o：其他人
- a：所有人
- +：添加权限
- -：移除权限
- =：设定权限
```

为 .bashrc 文件的所有用户添加写权限。

```html
# chmod a+w .bashrc
```

**默认权限**

- 文件默认权限：文件默认没有可执行权限，因此为 **666**，也就是 -rw-rw-rw- 。
- 目录默认权限：目录必须要能够进入，也就是必须拥有可执行权限，因此为 **777** ，也就是 drwxrwxrwx。

Linux的chmod命令，对一个目录及其子目录所有文件添加权限

```
chmod 777 -R ./html
```

umask  022  表示默认创建新文件权限为755，也就是 rxwr-xr-x(所有者全部du权限，属zhi组读写，其它人读写) 

umask  0027  表示默认创建新文件权限为750，也就是rxwr-x---(所有者全部权限，属组读写，其它人无)。



### 压缩与打包的操作命令

- 打包并压缩文件，打包并压缩后的文件的后缀名一般.tar.gz。

  **`tar -zcvf 打包压缩后的文件名 要打包压缩的文件`** **`tar -zcvf test.tar.gz /test/`**

- 解压压缩包

  **`tar -xvf test.tar.gz -C /usr`**（-C代表指定解压的位置）

```shell
 z：调用gzip压缩命令进行压缩
 c：打包文件
 v：显示运行过程
 f：指定文件名
 x：代表解压
```

**zip、unzip**

zip [参数] [打包后的文件名] [打包的目录路径]

```shell
# zip -r test.zip tmb/
-a 将文件转成ASCII模式
-F 尝试修复损坏的压缩文件
-h 显示帮助界面
-m 将文件压缩之后，删除源文件
-n 特定字符串 不压缩具有特定字尾字符串的文件
-o 将压缩文件内的所有文件的最新变动时间设为压缩时候的时间
-q 安静模式，在压缩的时候不显示指令的执行过程
-r 将指定的目录下的所有子目录以及文件一起处理
-S 包含系统文件和隐含文件（S是大写）
```

unzip [待解压缩文件]  			unzip [参数] [待解压缩文件]

```shell
# unzip -q test.zip -d tmp/
-n 解压缩时不要覆盖原有的文件；
-o 不必先询问用户，unzip执行后覆盖原有的文件；
-P [密码] 使用zip的密码选项；
-q 执行时不显示任何信息；
-d [目录] 指定文件解压缩后所要存储的目录；
```



### 关机与重启

关机
    shutdown -h now        立刻关机
    shutdown -h 5       	  5分钟后关机
    poweroff            		  立刻关机
重启
    shutdown -r now        立刻重启
    shutdown -r 5        	 5分钟后重启
    reboot               		   立刻重启

### 帮助命令

**1. --help**  指令的基本用法与选项介绍。

**2. man**  man 是 manual 的缩写，将指令的具体信息显示出来。

当执行 `man date` 时，有 DATE(1) 出现，其中的数字代表指令的类型，常用的数字及其类型如下：

| 代号 | 类型                                            |
| :--: | ----------------------------------------------- |
|  1   | 用户在 shell 环境中可以操作的指令或者可执行文件 |
|  5   | 配置文件                                        |
|  8   | 系统管理员可以使用的管理指令                    |

**3. info**  info 与 man 类似，但是 info 将文档分成一个个页面，每个页面可以跳转。

**4. doc**  /usr/share/doc 存放着软件的一整套说明文件。



## VI、VIM

- 命令模式（Command mode）：VIM 的默认模式，可以用于移动游标查看内容；
- 插入模式（Insert mode）：按下 "i" 等按键之后进入，可以对文本进行编辑；
- 底行模式（Bottom-line mode）：按下 ":" 按键之后进入，用于保存退出等操作。

命令行模式下的常用命令：
   【1】控制光标移动：↑，↓，j
   【2】删除当前行：dd 
   【3】查找：/ ，？
   【4】进入编辑模式：i，o，a
   【5】进入底行模式：:

编辑模式下常用命令：
   【1】ESC 退出编辑模式到命令行模式；

底行模式下常用命令：
   【1】退出编辑：  :q
   【2】强制退出：  :q!
   【3】保存并退出：  :wq



## 查找命令

### grep 命令

grep命令是一种强大的文本搜索工具。

`ps -ef | grep sshd`  查找指定ssh服务进程

### find命令

find命令在目录结构中搜索文件，并对搜索结果执行指定的操作。 

`find . -name "*.log" -ls`  在当前目录查找以.log结尾的文件，并显示详细信息。

### locate命令

locate 让使用者可以很快速的搜寻某个路径。

`updatedb` 手动更新数据库

`locate /etc/sh` 搜索etc目录下所有以sh开头的文件 

### whereis命令

whereis命令是定位可执行文件、源代码文件、帮助文件在文件系统中的位置。

`whereis ls`    将和ls文件相关的文件都查找出来

### which命令

which命令的作用是在PATH变量指定的路径中，搜索某个系统命令的位置，并且返回第一个搜索结果。

`which java`  查找path中java的路径




## grep 命令
```
1.作用
Linux系统中grep命令是一种强大的文本搜索工具，它能使用正则表达式搜索文本，并把匹配的行打印出来。grep全称是Global Regular Expression Print，表示全局正则表达式版本，它的使用权限是所有用户。
2.格式
grep [options]
3.主要参数
[options]主要参数：
－c：只输出匹配行的计数。
－I：不区分大 小写(只适用于单字符)。
－h：查询多文件时不显示文件名。
－l：查询多文件时只输出包含匹配字符的文件名。
－n：显示匹配行及 行号。
－s：不显示不存在或无匹配文本的错误信息。
－v：显示不包含匹配文本的所有行。
pattern正则表达式主要参数：
\： 忽略正则表达式中特殊字符的原有含义。
^：匹配正则表达式的开始行。
$: 匹配正则表达式的结束行。
\<：从匹配正则表达 式的行开始。
\>：到匹配正则表达式的行结束。
[ ]：单个字符，如[A]即A符合要求 。
[ - ]：范围，如[A-Z]，即A、B、C一直到Z都符合要求 。
。：所有的单个字符。
* ：有字符，长度可以为0。
```

```
4.grep命令使用简单实例
$ grep ‘test’ d*
显示所有以d开头的文件中包含 test的行。
$ grep ‘test’ aa bb cc
显示在aa，bb，cc文件中匹配test的行。
$ grep ‘[a-z]\{5\}’ aa
显示所有包含每个字符串至少有5个连续小写字符的字符串的行。
$ grep ‘w\(es\)t.*\1′ aa
如果west被匹配，则es就被存储到内存中，并标记为1，然后搜索任意个字符(.*)，这些字符后面紧跟着 另外一个es(\1)，找到就显示该行。如果用egrep或grep -E，就不用”\”号进行转义，直接写成’w(es)t.*\1′就可以了。
```



## 内存使用情况

**free命令**

显示系统内存的使用情况，包括物理内存、交换内存(swap)和内核缓冲区内存等。

```
free -m					 //以 M 为单位显示内存使用情况：
free -h　　　　　　//以更友好的方式显示，会以K、M、G为单位来显示
free -h -s 3　　  //以一定时间间隔重复的输出，这个命令是每3秒输出一次
```

**top命令**

查看正在运行的进程和系统负载信息，包括cpu负载、内存使用、各个进程所占系统资源等，top命令以一定频率动态更新这些统计信息。

```
top -d 2						//两秒钟刷新一次
top -H -p 21564			//找到具体的线程占用情况
```

**vmstat命令**

对操作系统的虚拟内存、进程、CPU活动进行监控，是对系统的整体情况进行的统计。

```
vmstat 1　　　　//每隔1s打印一次
vmstat 1 5　　　//每隔1秒打印一次，打印五次
vmstat -s　　　//显示内存相关统计信息及多种系统活动数量
```

**cat /proc/meminfo**

/proc/meminfo是了解Linux系统内存使用状况的主要接口

**ps aux命令**

查看系统中各个进程的运行情况，包括了进程占用的内存，**%MEM** 列就是各个进程的内存占用百分比。

## 网络管理命令

`ifconfig` 查看和配置网卡信息

```
ifconfig	查看当前系统活动状态的网卡信息
ifconfig eth0 172.22.10.1 netmask 255.255.255.0 手动指定网卡IP
ifconfig eth0 down 手动断开网卡  up启用网卡
```

`route` 路由和网关设置

```
route -n	查看系统当前路由表
route add default gw 172.22.10.1
```

`ping ip` 查看与某台机器的连接情况

-c 指定次数 -i 指定发送间隔 -w指定超时时间

`host 域名` 根据域名返回IP 

`netstat -an` 查看当前系统端口，指定端口：netstat -an | grep 8080

`setup` 配置网络

`service network restart` 重启网络

`chkconfig iptables off` 关闭防火墙

`telnet IP` 登录指定IP的远程主机

## 进程管理命令

`ps -l` 查看自己的进程

`ps aux` 查看系统所有进程

`ps -ef | grep threadx` 查看特定的进程

`pstree -A` 查看所有进程树

`top` 实时显示进程信息

`netstat` 查看占用端口的进程

**进程状态**

| 状态 | 说明                                                         |
| :--: | ------------------------------------------------------------ |
|  R   | running or runnable (on run queue)<br>正在执行或者可执行，此时进程位于执行队列中。 |
|  D   | uninterruptible sleep (usually I/O)<br>不可中断阻塞，通常为 IO 阻塞。 |
|  S   | interruptible sleep (waiting for an event to complete) <br> 可中断阻塞，此时进程正在等待某个事件完成。 |
|  Z   | zombie (terminated but not reaped by its parent)<br>僵死，进程已经终止但是尚未被其父进程获取信息。 |
|  T   | stopped (either by a job control signal or because it is being traced) <br> 结束，进程既可以被作业控制信号结束，也可能是正在被追踪。 |

## Tomcat相关命令

```
查看tomact日志
  tail -f catalina.out 
查看Tomcat是否以关闭
  ps -ef|grep java
杀死Tomcat进程
  kill -9 8080
关闭Tomcat命令
  ./shutdown.sh
启动Tomcat命令
  ./startup.sh
清理catalina.out
  echo "">catalina.out
```

## Nginx相关命令

```
/usr/local/webserver/nginx/sbin/nginx #启动命令
/usr/local/webserver/nginx/sbin/nginx -s reload #重新载入配置文件
/usr/local/webserver/nginx/sbin/nginx -s reopen #重启 Nginx
/usr/local/webserver/nginx/sbin/nginx -s stop #停止 Nginx
/usr/local/webserver/nginx/sbin/nginx -t #检查配置文件正确性
```



## 管道指令

管道是将一个命令的标准输出作为另一个命令的标准输入，在数据需要经过多个步骤的处理之后才能得到我们想要的内容时就可以使用管道。在命令之间使用 | 分隔各个管道命令。

```bash
$ ls -al /etc | less
```

- 提取指令

cut 对数据进行切分，取出想要的部分。切分过程一行一行地进行。

```html
$ cut
-d ：分隔符
-f ：经过 -d 分隔后，使用 -f n 取出第 n 个区间
-c ：以字符为单位取出区间
```

示例 1：last 显示登入者的信息，取出用户名。

```html
$ last
root pts/1 192.168.201.101 Sat Feb 7 12:35 still logged in
root pts/1 192.168.201.101 Fri Feb 6 12:13 - 18:46 (06:33)
root pts/1 192.168.201.254 Thu Feb 5 22:37 - 23:53 (01:16)

$ last | cut -d ' ' -f 1
```

示例 2：将 export 输出的信息，取出第 12 字符以后的所有字符串。

```html
$ export
declare -x HISTCONTROL="ignoredups"
declare -x HISTSIZE="1000"
declare -x HOME="/home/dmtsai"
declare -x HOSTNAME="study.centos.vbird"
.....(其他省略).....

$ export | cut -c 12-
```

- 排序指令

**sort**   用于排序。

```html
$ sort [-fbMnrtuk] [file or stdin]
-f ：忽略大小写
-b ：忽略最前面的空格
-M ：以月份的名字来排序，例如 JAN，DEC
-n ：使用数字
-r ：反向排序
-u ：相当于 unique，重复的内容只出现一次
-t ：分隔符，默认为 tab
-k ：指定排序的区间
```

示例：/etc/passwd 文件内容以 : 来分隔，要求以第三列进行排序。

```html
$ cat /etc/passwd | sort -t ':' -k 3
root:x:0:0:root:/root:/bin/bash
dmtsai:x:1000:1000:dmtsai:/home/dmtsai:/bin/bash
alex:x:1001:1002::/home/alex:/bin/bash
arod:x:1002:1003::/home/arod:/bin/bash
```

**uniq**   可以将重复的数据只取一个。

```html
$ uniq [-ic]
-i ：忽略大小写
-c ：进行计数
```

示例：取得每个人的登录总次数

```html
$ last | cut -d ' ' -f 1 | sort | uniq -c
1
6 (unknown
47 dmtsai
4 reboot
7 root
1 wtmp
```



## su、sudo

su用于用户之间的切换。但是切换前的用户依然保持登录状态。如果是root 向普通或虚拟用户切换不需要密码，反之普通用户切换到其它任何用户都需要密码验证。

sudo是为所有想使用root权限的普通用户设计的。可以让普通用户具有临时使用root权限的权利。只需输入自己账户的密码即可。

## awk 命令

AWK 是一种处理文本文件的语言，是一个强大的文本分析工具。

```
awk '{[pattern] action}' {filenames}   # 行匹配语句 awk '' 只能用单引号

awk '{print $2}' log.txt	#打印log文件的第二列
```

## crontab 命令

Linux crontab是用来定期执行程序的命令。当安装完成操作系统之后，默认便会启动此任务调度命令。

crontab 是用来让使用者在固定时间或固定间隔执行程序之用，换句话说，也就是类似使用者的时程表。

```linux
crontab [-u user] file
crontab [-u user] {-l|-r|-e}
```

- file是命令文件的名字,表示将file做为crontab的任务列表文件并载入crontab。
- -u user 是指设定指定 user 的时程表，这个前提是你必须要有其权限(比如说是 root)才能够指定他人的时程表。如果不使用 -u user 的话，就是表示设定自己的时程表。
- -l : 列出目前的时程表
- -r : 删除目前的时程表
- -e : 执行文字编辑器来设定时程表，内定的文字编辑器是vi

```
命令：*   *   *   *   *   command  
解释：分  时  日  月   周   命令

先打开定时任务所在的文件：
crontab -e
每分钟执行一次date命令 
*/1 * * * * date >> /root/date.txt
每周六、周日的1 : 10重启apache。 
10 1 * * 6,0 service httpd restart
```

## ln 命令

**ln命令**用来为文件创建连接，连接类型分为硬连接和软连接两种，默认的连接类型是硬连接。如果要创建软连接必须使用"-s"选项。

ln -s 源文件 目标文件

ln -s /home/Axing/webapps/root/classes/linux/x64/  /app

这样创建了软连接之后，可以直接在 /app下查找 /home/Axing/webapps/root/classes/linux/x64/ 下的所以文件和文件夹

## diff 命令

diff命令用于比较文件的差异。diff以逐行的方式，比较文本文件的异同处。如果指定要比较目录，则diff会比较目录中相同文件名的文件，但不会比较其中子目录。

```
diff file1.txt file2.txt -y	#以并列的方式显示文件的异同之处。
|表示不同, <表示后面文件少了一行内容，>表示多了一行。
```







